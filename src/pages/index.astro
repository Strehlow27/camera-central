---
import BaseLayout from "../layouts/BaseLayout.astro";

// ✅ Uses Vercel's latest deploy commit timestamp (seconds since epoch)
const lastUpdatedISO = import.meta.env.VERCEL_GIT_COMMIT_TIMESTAMP
  ? new Date(Number(import.meta.env.VERCEL_GIT_COMMIT_TIMESTAMP) * 1000).toISOString()
  : null;
---

<BaseLayout title="Camera Central">
  <h1 class="text-4xl font-semibold tracking-tight max-w-2xl">
    Choose the right camera in under 2 minutes.
  </h1>

  {lastUpdatedISO && (
    <div class="mt-3">
      <span
        class="inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1 text-xs text-gray-600"
      >
        <span class="h-2 w-2 rounded-full bg-green-500"></span>
        <span>
          Last updated <strong id="ccUpdatedAgo">recently</strong>
        </span>
      </span>

      <script is:inline data-updated={lastUpdatedISO}>
        (function () {
          const iso = document.currentScript?.getAttribute("data-updated");
          const el = document.getElementById("ccUpdatedAgo");
          if (!iso || !el) return;

          const updated = new Date(iso).getTime();
          const now = Date.now();
          const diffMs = now - updated;

          const mins = Math.floor(diffMs / (1000 * 60));
          const hours = Math.floor(mins / 60);
          const days = Math.floor(hours / 24);

          if (mins < 60) {
            el.textContent = `${mins} minute${mins === 1 ? "" : "s"} ago`;
          } else if (hours < 24) {
            el.textContent = `${hours} hour${hours === 1 ? "" : "s"} ago`;
          } else {
            el.textContent = `${days} day${days === 1 ? "" : "s"} ago`;
          }
        })();
      </script>
    </div>
  )}

  <p class="text-lg text-gray-600 max-w-2xl leading-relaxed mt-4">
    Camera Central asks a few questions, explains the tradeoffs,
    and recommends 1–3 cameras that actually fit how you shoot.
  </p>

  {lastUpdatedISO && (
    <>
      <p class="mt-2 text-sm text-gray-400 max-w-2xl">
        Updated <span id="ccUpdatedAgo">recently</span>
      </p>

      <script is:inline data-updated={lastUpdatedISO}>
        (function () {
          const iso = document.currentScript?.getAttribute("data-updated");
          const el = document.getElementById("ccUpdatedAgo");
          if (!iso || !el) return;

          const days = Math.max(
            0,
            Math.floor((Date.now() - new Date(iso).getTime()) / 86400000)
          );

          el.textContent = days <= 0 ? "today" : `${days} day${days === 1 ? "" : "s"} ago`;
        })();
      </script>
    </>
  )}

  <div class="mt-10">
    <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 max-w-md">
      <h2 class="font-semibold text-lg mb-2">Take the quiz!</h2>

      <p class="text-gray-600 mb-4">
        Answer a few questions and we’ll recommend the best camera for you.
      </p>

      <a
        href="/find"
        class="inline-block bg-black text-white px-5 py-2 rounded-lg hover:bg-gray-800"
      >
        Find my camera
      </a>
    </div>
  </div>
</BaseLayout>